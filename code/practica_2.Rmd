---
title: "Tipologia i cicle de vida de les dades - Pràctica 2"
author: "Autor: Isabel Barrera Benavent i Maria Font Sánchez"
date: "Decembre 2021"
output:
  word_document: default
  pdf_document:
    highlight: zenburn
    toc: yes
  html_document:
    highlight: default
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval=T, echo=T, fig.width=12, fig.height=8)
```

```{r message= FALSE, warning=FALSE}
```

*****
# Integració i selecció de les dades d'interès a analitzar
*****

Per tal de poder realitzar la selecció de les dades d'interès a analitzar, el primer pas és fer la lectura del fitxer CSV anomenat 'marketing_campaign.csv':

```{r message= FALSE, warning=FALSE}
data_clients<-read.csv("../data/marketing_campaign.csv", header=T, sep="\t")
```

D'aquestes 29 variables, ens interessa quedar-nos amb les següents:

- ID: identificador únic

  Perfil del client:
- Year_Birth
- Education
- Marital_status
- Income
- Kidhome
- Teenhome
- Dt_Customer

  Gasto per productes alimentaris:
- MntFruits
- MntMeatProducts
- MntFishProducts
- MntSweetProducts
- NumWebPurchases
- NumCatalogPurchases
- NumStorePurchases

La resta de variables, degut a que no es faran servir, s'eliminen del conjunt de dades:

```{r message= FALSE, warning=FALSE}
data_clients <- data_clients[, c('ID', 'Year_Birth', 'Education', 'Marital_Status', 'Income', 'Kidhome', 'Teenhome', 
                                 'Dt_Customer', 'MntFruits', 'MntMeatProducts', 'MntFishProducts', 'MntSweetProducts',
                                 'NumWebPurchases', 'NumCatalogPurchases', 'NumStorePurchases')]

```

*****
# Neteja de dades
*****

Abans de començar amb la neteja de dades, cal mirar el tipus de dades que R ha assignat a cada columna, i també amb la funció 'summary' es pot veure els valors màxims, mínims i les mitjanes de les variables numèriques.

```{r message= FALSE, warning=FALSE}
summary(data_clients)
```

Es pot observar que les variables 'Education', 'Marital Status' i 'Dt Customer' són les úniques expressades com a text. La resta de variables són numèriques.

Primer, es validarà que les variables de text 'Education' i 'Marital Status' es poden categoritzar:

```{r message= FALSE, warning=FALSE}
table(data_clients$Education)
table(data_clients$Marital_Status)
```

Totes dues variables es poden categoritzar:

```{r message= FALSE, warning=FALSE}
data_clients$Education <- as.factor(data_clients$Education)
data_clients$Marital_Status <- as.factor(data_clients$Marital_Status)
```


*****
## Zeros o elements buits
*****

### Les dades contenen zeros o elements buits? Com gestionaries aquests casos?

Les variables numèriques utilitzen el valor 0 per indicar que no es té informació. I les de tipus text ho indiquen mitjançant els elements buits.
El primer pas per a fer aquesta comprobació, es validar si existeixen valors buits en les variables seleccionades:

```{r message= FALSE, warning=FALSE}
colSums(is.na(data_clients))
```

En aquest cas, la variable 'Income' en té 24. Per tal de gestionar aquests valors, hi ha diverses tècniques que es poden aplicar:
- Eliminar aquests registres.
- Aplicar la mitjana dels valors més propers.

Degut a que es tracta d'1% dels registres totals, es preferible eliminar-los ja que l'impacte i la pèrduda de dades és mínima:

```{r message= FALSE, warning=FALSE}
data_clients <- data_clients[, !colMeans(is.na(data_clients))]
colSums(is.na(data_clients))
```


### Identificació i tractament de valors extrems

El següent pas és identificar els valors extrems, que són les dades que es troben allunyades de la distribució normal.

Utilitzarem la funció boxplots.stats() de R per anar revisant variable a variable si trobem registres amb valors extrems 
que es puguin considerar incorrectes o que ens pugui implicar una desviació important. 

VARIABLE YEAR_BIRTH

```{r message= FALSE, warning=FALSE}
boxplot.stats(data_clients$Year_Birth)$out
summary(data_clients$Year_Birth)

## En aquest cas considerem que aquests 3 valors són incorrectes, ja que implicaria que actualment tenen més de 130 anys.
## Decidim canviar-los per el valor mitjà.

data_clients$Year_Birth[(data_clients$Year_Birth==1893)] <- 1970
data_clients$Year_Birth[(data_clients$Year_Birth==1900)] <- 1970
data_clients$Year_Birth[(data_clients$Year_Birth==1899)] <- 1970
```

VARIABLES EDUCATION, MARITAL STATUS, KIDHOME, TEENHOME I NUMSTORESPURCHASES:  

```{r message= FALSE, warning=FALSE}
boxplot.stats(data_clients$Education)$out
boxplot.stats(data_clients$Marital_Status)$out
boxplot.stats(data_clients$Kidhome)$out
boxplot.stats(data_clients$Teenhome)$out
boxplot.stats(data_clients$NumStorePurchases)$out

table(data_clients$Education)
table(data_clients$Marital_Status)
table(data_clients$Kidhome)
table(data_clients$Teenhome)
table(data_clients$NumStorePurchases)

## No sembla que hi hagin valors extrems. 
## Revisem els seus valor amb la funció table
```

VARIABLE DT_CUSTOMER:  
```{r message= FALSE, warning=FALSE}
# Revisem els anys de les dates de clients per si veiem alguna cosa rara.

boxplot(as.numeric(substring(data_clients$Dt_Customer,7,10)))
table(as.numeric(substring(data_clients$Dt_Customer,7,10)))

## Tant la seva representació en boxplot com en taula és correcta.
```
VARIABLE NUMWEBPURCHASES: 

```{r message= FALSE, warning=FALSE}
boxplot.stats(data_clients$NumWebPurchases)$out
summary(data_clients$NumWebPurchases)

## Els valors extrems són valors que es poden donar. Els donem per bons.
```

VARIBALE NUMCATALOGPURCHAES:
```{r message= FALSE, warning=FALSE}
boxplot.stats(data_clients$NumCatalogPurchases)$out
summary(data_clients$NumCatalogPurchases)

## Els valors extrems són valors que es poden donar. Els donem per bons.
```
VARIABLE MNTFRUITS:
```{r message= FALSE, warning=FALSE}
## Al tenir tants valors diferents, representem el seu boxplot:

boxplot(data_clients$MntFruits)
summary(data_clients$MntFruits)

## Veiem que hi han valors que estàn fora de ho esperat pero no allunyats entre ells i a més es poden donar.
## Ho donem per bo.
```
VARIABLE MNTFISHPRODUCTS:
```{r message= FALSE, warning=FALSE}
 
## Al tenir tants valors diferents, representem el seu boxplot
boxplot(data_clients$MntFishProducts)
summary(data_clients$MntFishProducts)
## Veiem que hi han valors que estàn fora de ho esperat pero no allunyats entre ells i a més es poden donar.
## Ho donem per bo.
```
VARIABLE MNTSWEETPRODUCTS:
```{r message= FALSE, warning=FALSE}
boxplot(data_clients$MntSweetProducts)
summary(data_clients$MntSweetProducts)

## Veiem que hi han un valor que estàn molt fora de ho esperat.
## Al ser només un el canviem per la mitjana.

data_clients$MntSweetProducts[(data_clients$MntSweetProducts==262)] <- 8
```
VARIABLE MNTMEATPRODUCTS;
```{r message= FALSE, warning=FALSE}
## Camp MntMeatProducts:  
## Al tenir tants valors diferents, representem el seu boxplot
boxplot(data_clients$MntMeatProducts)
summary(data_clients$MntMeatProducts)
## Sembla que hi han uns 4 valors superiors dels 1500 i diferenciats dels altres.
table(data_clients$MntMeatProducts[(data_clients$MntMeatProducts>1500)] )
## Els canviem per la seva mitjana:
data_clients$MntMeatProducts[(data_clients$MntMeatProducts>1500)]->67
```



*****
## Anàlisi de les dades
*****

### Selecció dels grups de dades que es volen analitzar/comparar (planificació dels anàlisis a aplicar)






